# 1. ä½¿ç”¨çš„æŠ€æœ¯ç‚¹

## 1.1 åŠ å¯†

åˆ†ä¸ºå¯é€†åŠ å¯†å’Œä¸é€†å¯åŠ å¯†

1. å¯é€†åŠ å¯†ï¼š
   - å¯¹ç§°åŠ å¯†ï¼šã€**æ–‡ä»¶åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œå³åŠ å¯†å¯†é’¥ä¹Ÿå¯ä»¥ç”¨ä½œè§£å¯†å¯†é’¥**ã€‘
     - **å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—ï¼š**AESã€DESã€3DESã€Blowfishã€IDEAã€RC4ã€RC5ã€RC6ã€HS256
     - **ç”¨é€”ï¼š** ä¸€èˆ¬ç”¨äºä¿å­˜ç”¨æˆ·æ‰‹æœºå·ã€èº«ä»½è¯ç­‰æ•æ„Ÿä½†èƒ½è§£å¯†çš„ä¿¡æ¯ã€‚
     - **ä¼˜ç‚¹:**  å¯¹ç§°åŠ å¯†ç®—æ³•çš„ä¼˜ç‚¹æ˜¯ç®—æ³•å…¬å¼€ã€è®¡ç®—é‡å°ã€åŠ å¯†é€Ÿåº¦å¿«ã€åŠ å¯†æ•ˆç‡é«˜ã€‚
     - **ç¼ºç‚¹:**  æ²¡æœ‰éå¯¹ç§°åŠ å¯†å®‰å…¨.
     - ![image-20221231212714300](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2022/12/31_21_27_14_image-20221231212714300.png)
   - éå¯¹ç§°åŠ å¯†ï¼šå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼›ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ã€‚
     - **å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—ï¼š**RSAã€DSAï¼ˆæ•°å­—ç­¾åç”¨ï¼‰ã€ECCï¼ˆç§»åŠ¨è®¾å¤‡ç”¨ï¼‰ã€RS256 (é‡‡ç”¨SHA-256 çš„ RSA ç­¾å)
     - **ç”¨é€”ï¼š** ä¸€èˆ¬ç”¨äºç­¾åå’Œè®¤è¯ã€‚ç§é’¥æœåŠ¡å™¨ä¿å­˜, ç”¨æ¥åŠ å¯†,  å…¬é’¥å®¢æˆ·æ‹¿ç€ç”¨äºå¯¹äºä»¤ç‰Œæˆ–è€…ç­¾åçš„è§£å¯†æˆ–è€…æ ¡éªŒä½¿ç”¨.
     - **ä¼˜ç‚¹: ** éå¯¹ç§°åŠ å¯†ä¸å¯¹ç§°åŠ å¯†ç›¸æ¯”ï¼Œå…¶å®‰å…¨æ€§æ›´å¥½ï¼›
     - **ç¼ºç‚¹:**  éå¯¹ç§°åŠ å¯†çš„ç¼ºç‚¹æ˜¯åŠ å¯†å’Œè§£å¯†èŠ±è´¹æ—¶é—´é•¿ã€é€Ÿåº¦æ…¢ï¼Œåªé€‚åˆå¯¹å°‘é‡æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚
     - **ç­¾åï¼š**ç§é’¥ç­¾å,  æŒæœ‰å…¬é’¥è¿›è¡ŒéªŒè¯æ˜¯å¦è¢«ç¯¡æ”¹è¿‡.
     - ![image-20221231212659070](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2022/12/31_21_27_6_image-20221231212659070.png)
2. ä¸å¯é€†åŠ å¯†ï¼šä¸€æ—¦åŠ å¯†å°±ä¸èƒ½åå‘è§£å¯†å¾—åˆ°å¯†ç åŸæ–‡
   - **ç§ç±»ï¼š**HashåŠ å¯†ç®—æ³•, æ•£åˆ—ç®—æ³•, æ‘˜è¦ç®—æ³•ç­‰
   - **ç”¨é€”ï¼š**ä¸€èˆ¬ç”¨äºæ•ˆéªŒä¸‹è½½æ–‡ä»¶æ­£ç¡®æ€§ï¼Œä¸€èˆ¬åœ¨ç½‘ç«™ä¸Šä¸‹è½½æ–‡ä»¶éƒ½èƒ½è§åˆ°ï¼›å­˜å‚¨ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç ã€ å¡å·ç­‰ä¸å¯è§£å¯†çš„ä¿¡æ¯
   - **å¸¸è§çš„ä¸å¯é€†åŠ å¯†ç®—æ³•æœ‰ï¼š** `MD5ã€SHAã€HMACã€BCrypt`

### 1.1.1 TokenéªŒè¯ï¼ˆJWTä»¤ç‰Œï¼‰

ä½¿ç”¨Base64ç¼–ç 

Base64æ˜¯ç½‘ç»œä¸Šæœ€å¸¸è§çš„ç”¨äºä¼ è¾“8Bitå­—èŠ‚ä»£ç çš„ç¼–ç æ–¹å¼ä¹‹ä¸€ã€‚Base64ç¼–ç å¯ç”¨äºåœ¨HTTPç¯å¢ƒä¸‹ä¼ é€’è¾ƒé•¿çš„æ ‡è¯†ä¿¡æ¯ã€‚é‡‡ç”¨Base64Base64ç¼–ç è§£ç å…·æœ‰ä¸å¯è¯»æ€§ï¼Œå³æ‰€ç¼–ç çš„æ•°æ®ä¸ä¼šè¢«äººç”¨è‚‰çœ¼æ‰€ç›´æ¥çœ‹åˆ°ã€‚**æ³¨æ„ï¼šBase64åªæ˜¯ä¸€ç§ç¼–ç æ–¹å¼ï¼Œä¸ç®—åŠ å¯†æ–¹æ³•ã€‚**

æˆ‘ä»¬ç°åœ¨äº†è§£äº†åŸºäºtokenè®¤è¯çš„äº¤äº’æœºåˆ¶ï¼Œä½†ä»¤ç‰Œé‡Œé¢ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå†…å®¹ï¼Ÿä»€ä¹ˆæ ¼å¼å‘¢ï¼Ÿå¸‚é¢ä¸ŠåŸºäºtokençš„è®¤è¯æ–¹å¼å¤§éƒ½é‡‡ç”¨çš„æ˜¯JWT(Json Web Token)ã€‚

â€‹	JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾çš„è¡Œä¸šæ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç®€æ´çš„ã€è‡ªåŒ…å«çš„åè®®æ ¼å¼ï¼Œç”¨äºåœ¨é€šä¿¡åŒæ–¹ä¼ é€’jsonå¯¹è±¡ï¼Œä¼ é€’çš„ä¿¡æ¯ç»è¿‡æ•°å­—ç­¾åå¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ã€‚

**JWTä»¤ç‰Œç»“æ„ï¼š**

JWTä»¤ç‰Œç”±Headerã€Payloadã€Signatureä¸‰éƒ¨åˆ†ç»„æˆï¼Œæ¯éƒ¨åˆ†ä¸­é—´ä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”ï¼Œæ¯”å¦‚ï¼šxxxxx.yyyyy.zzzzz

base64UrlEncode(header)ï¼šjwtä»¤ç‰Œçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚base64UrlEncode(payload)ï¼šjwtä»¤ç‰Œçš„ç¬¬äºŒéƒ¨åˆ†ã€‚
secretï¼šç­¾åæ‰€ä½¿ç”¨çš„å¯†é’¥ã€‚

åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š

1. Headerï¼ˆå¤´éƒ¨ï¼‰ï¼šåŒ…æ‹¬ä»¤ç‰Œçš„ç±»å‹ï¼ˆå³JWTï¼‰åŠä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼ˆå¦‚HMACã€SHA256æˆ–RSAï¼‰

   - ä¾‹å¦‚ï¼š

     ```
     {
     "alg": "HS256",
     "typ": "JWT"
     }
     JWTä»¤ç‰Œçš„ç¬¬ä¸€éƒ¨åˆ†
     ```

2. Payloadï¼ˆè´Ÿè½½ï¼‰ï¼šå†…å®¹ä¹Ÿæ˜¯ä¸€ä¸ªjsonå¯¹è±¡ï¼Œå®ƒæ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹ï¼Œå®ƒå¯ä»¥å­˜æ”¾jwtæä¾›çš„ç°æˆå­—æ®µï¼Œæ¯”å¦‚ï¼šissï¼ˆç­¾å‘è€…ï¼‰ï¼Œexpï¼ˆè¿‡æœŸæ—¶é—´æˆ³ï¼‰ï¼Œ subï¼ˆé¢å‘çš„ç”¨æˆ·ï¼‰ç­‰ï¼Œä¹Ÿå¯è‡ªå®šä¹‰å­—æ®µã€‚

   æ­¤éƒ¨åˆ†ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºæ­¤éƒ¨åˆ†å¯ä»¥è§£ç è¿˜åŸåŸå§‹å†…å®¹ã€‚

   - ä¾‹å¦‚ï¼š

     ```
     {
     "sub": "1234567890",
     "name": "456",
     "admin": true
     }
     JWTä»¤ç‰Œçš„ç¬¬è€Œéƒ¨åˆ†
     ```

3. Signatureï¼ˆç­¾åï¼‰æ­¤éƒ¨åˆ†ç”¨äºé˜²æ­¢jwtå†…å®¹è¢«ç¯¡æ”¹ã€‚è¿™ä¸ªéƒ¨åˆ†ä½¿ç”¨base64urlå°†å‰ä¸¤éƒ¨åˆ†è¿›è¡Œç¼–ç ï¼Œç¼–ç åä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰è¿æ¥ç»„æˆå­—ç¬¦ä¸²ï¼Œæœ€åä½¿ç”¨headerä¸­å£°æ˜ç­¾åç®—æ³•è¿›è¡Œç­¾åã€‚

   - ä¾‹å¦‚

   - ```
     HMACSHA256(base64UrlEncode(header) + "." +base64UrlEncode(payload)ï¼Œsecret)
     JWTä»¤ç‰Œçš„ç¬¬ä¸‰éƒ¨åˆ†
     ```

#### å®ç°

éœ€è¦å¼•å…¥jwtç›¸å…³ä¾èµ–

```xml
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt</artifactId>
</dependency>
```



æ–°å»ºå•å…ƒæµ‹è¯•

``````java
/**
 * jwtç”Ÿæˆä¸è§£æä»‹ç»
 */
public class JWTTest {


    /**
     * ç”ŸæˆJWTï¼ˆä¸€èˆ¬åœ¨ç™»å½•æˆåŠŸåå°†ç”Ÿæˆçš„JWTå½“åšTOKENæ¥ä½¿ç”¨ï¼‰
      */
    @Test
    public void testCreateJwt(){
        //eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJjZTAyNzQ5NC1hZjc4LTQ1MTMtODY2Ni0xYjQxMTNiZjc4ZWQiLCJzdWIiOiJhbGwiLCJ1c2VybmFtZSI6InpoYW5nc2FuIiwidXNlcklkIjoxMjMsImlhdCI6MTYxNDE0OTg3NSwiZXhwIjoxNjE0MTUzNDc1fQ.AxKYDz5vHg_EnGxm8Z9zH6oDpSKQZBjDiiEsNt_aec8
        String secret = "itcast"; //å¯¹ç§°åŠ å¯†å¯†é’¥
        String token = Jwts.builder()ã€
            	.signWith(SignatureAlgorithm.HS256, secret)// åŠ å¯†æ–¹å¼å’ŒåŠ å¯†çš„Key é˜²æ­¢æ¶æ„ç¯¡æ”¹æ•°æ®
                .setId(UUID.randomUUID().toString()) //jwtçš„å”¯ä¸€æ ‡è¯† 
                .setSubject("all")
                .claim("username", "zhangsan")
                .claim("userId",123)
                .setIssuedAt(new Date())//åˆ›å»ºæ—¶é—´
                .setExpiration(new Date(System.currentTimeMillis() + 60 * 60 * 1000)) //1å°æ—¶è¿‡æœŸ
                .compact();
        System.out.println(token);
    }

    /**
     * è§£æJWTï¼ˆä¸€èˆ¬ç™»é™†åè®¿é—®ç³»ç»Ÿæ—¶éœ€è¦æºå¸¦TOKENå­—ç¬¦ä¸²ï¼Œç³»ç»Ÿä¼šä½¿ç”¨JWTå·¥å…·ç±»æ ¡éªŒTOKENå­—ç¬¦ä¸²ï¼‰
     */
    @Test
    public void testParseJwt(){
        String secret = "itcast"; //å¯¹ç§°åŠ å¯†å¯†é’¥
        String token = "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJjZTAyNzQ5NC1hZjc4LTQ1MTMtODY2Ni0xYjQxMTNiZjc4ZWQiLCJzdWIiOiJhbGwiLCJ1c2VybmFtZSI6InpoYW5nc2FuIiwidXNlcklkIjoxMjMsImlhdCI6MTYxNDE0OTg3NSwiZXhwIjoxNjE0MTUzNDc1fQ.AxKYDz5vHg_EnGxm8Z9zH6oDpSKQZBjDiiEsNt_aec8";
        Jws<Claims> claimsJws = Jwts.parser().setSigningKey(secret).parseClaimsJws(token);
        System.out.println("å¤´ï¼š" + claimsJws.getHeader());
        System.out.println("è½½è·ï¼š"   +  claimsJws.getBody());
        System.out.println("userIdï¼š" +  claimsJws.getBody().get("userId"));
        System.out.println("ç­¾åï¼š" + claimsJws.getSignature());
    }

}
``````



### 1.1.2 BcryptåŠ å¯†

åœ¨ç”¨æˆ·æ¨¡å—ï¼Œå¯¹äºç”¨æˆ·å¯†ç çš„ä¿æŠ¤ï¼Œé€šå¸¸éƒ½ä¼šè¿›è¡ŒåŠ å¯†ã€‚æˆ‘ä»¬é€šå¸¸å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œåœ¨ç”¨æˆ·è¿›è¡Œç™»å½•çš„æ—¶å€™ï¼Œå°†å…¶è¾“å…¥çš„å¯†ç è¿›è¡ŒåŠ å¯†ç„¶åä¸æ•°æ®åº“ä¸­å­˜æ”¾çš„å¯†æ–‡è¿›è¡Œæ¯”è¾ƒï¼Œä»¥éªŒè¯ç”¨æˆ·å¯†ç æ˜¯å¦æ­£ç¡®ã€‚  ç›®å‰ï¼ŒMD5å’ŒBCryptæ¯”è¾ƒæµè¡Œã€‚ç›¸å¯¹æ¥è¯´ï¼ŒBCryptæ¯”MD5æ›´å®‰å…¨ã€‚

BCrypt å®˜ç½‘[http://www.mindrot.org/projects/jBCrypt/](http://www.mindrot.org/projects/jBCrypt/)

ï¼ˆ1ï¼‰æˆ‘ä»¬ä»å®˜ç½‘ä¸‹è½½æºç 

ï¼ˆ2ï¼‰æ–°å»ºå·¥ç¨‹ï¼Œå°†æºç ç±»BCryptæ‹·è´åˆ°å·¥ç¨‹

ï¼ˆ3ï¼‰æ–°å»ºæµ‹è¯•ç±»ï¼Œmainæ–¹æ³•ä¸­ç¼–å†™ä»£ç ï¼Œå®ç°å¯¹å¯†ç çš„åŠ å¯†

ï¼ˆ4ï¼‰æ–°å»ºå•å…ƒæµ‹è¯•ç¼–å†™ä»£ç ï¼Œå®ç°å¯¹å¯†ç çš„æ ¡éªŒã€‚BCryptä¸æ”¯æŒåè¿ç®—ï¼Œåªæ”¯æŒå¯†ç æ ¡éªŒã€‚

```java
/**
 * åŠ å¯†æ–¹å¼æµ‹è¯•
 */
public class EncryptTest {

   /**
     * æµ‹è¯•bcryptåŠ å¯†ï¼ˆå¸¸ç”¨äºç”¨æˆ·æ³¨å†Œæˆ–æ–°å¢ç”¨æˆ·å¯¹å¯†ç è¿›è¡Œå¯†ç ï¼‰
     */
    @Test
    public void testBCryptForRegister(){
        for (int i = 0; i < 10; i++) {
            String pwd = "123456";
            String salt =  BCrypt.gensalt();
            String pwdEncrypt = BCrypt.hashpw(pwd,salt);
            System.out.println("ç›ï¼š"+salt+"ï¼ŒåŠ å¯†åï¼š " +pwdEncrypt);
        }
    }


    /**
     * æµ‹è¯•BCryptæ ¡éªŒï¼ˆå¸¸ç”¨äºç”¨æˆ·ç™»å½•æ—¶åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®ï¼‰
     */
    @Test
    public void testBCryptForLogin(){
        String pwd = "123456";
        String pwdDB = "$2a$10$owzLG4fiZ4vmUSnmubaY9.FGcTuCDsRqvKNn3wiuYhQnyXNgO.96i";

        boolean result = BCrypt.checkpw(pwd, pwdDB);
        if(result){
            System.out.println("ç™»å½•æˆåŠŸ");
        } else {
            System.out.println("å¯†ç é”™è¯¯ç™»å½•å¤±è´¥");
        }
    }
}
```

#### MD5åŠ ç›å’ŒBCryptçš„åŒºåˆ«

MD5åŠ ç›ï¼ˆéšæœºç›ï¼‰éœ€è¦è®°å½•åŠ ç›çš„å€¼ï¼Œè€ŒBCryptä¸éœ€è¦è®°å½•ï¼ŒèŠ‚çœæ•°æ®åº“ç©ºé—´

Bcryptç”Ÿæˆçš„å¯†æ–‡æ˜¯60ä½çš„ã€‚è€ŒMD5çš„æ˜¯32ä½çš„ã€‚

BCryptæ¯”MD5æ›´å®‰å…¨ï¼Œä½†æ˜¯åŠ å¯†æ›´æ…¢

## 1.2 swaggeråŠ knife4jï¼ˆAPIPost APIFoxï¼‰

Swagger æ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ– RESTful é£æ ¼çš„ Web æœåŠ¡(<https://swagger.io/>)ã€‚ å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š

1. ä½¿å¾—å‰åç«¯åˆ†ç¦»å¼€å‘æ›´åŠ æ–¹ä¾¿ï¼Œæœ‰åˆ©äºå›¢é˜Ÿåä½œ

2. æ¥å£çš„æ–‡æ¡£åœ¨çº¿è‡ªåŠ¨ç”Ÿæˆï¼Œé™ä½åç«¯å¼€å‘äººå‘˜ç¼–å†™æ¥å£æ–‡æ¡£çš„è´Ÿæ‹…

3. åŠŸèƒ½æµ‹è¯• 

   Springå·²ç»å°†Swaggerçº³å…¥è‡ªèº«çš„æ ‡å‡†ï¼Œå»ºç«‹äº†Spring-swaggeré¡¹ç›®ï¼Œç°åœ¨å«Springfoxã€‚é€šè¿‡åœ¨é¡¹ç›®ä¸­å¼•å…¥Springfox ï¼Œå³å¯éå¸¸ç®€å•å¿«æ·çš„ä½¿ç”¨Swaggerã€‚

SpringBooté›†æˆSwagger

- å¼•å…¥ä¾èµ–,åœ¨heima-leadnews-modelå’Œheima-leadnews-commonæ¨¡å—ä¸­å¼•å…¥è¯¥ä¾èµ–

  ```xml
  <dependency>
      <groupId>io.springfox</groupId>
      <artifactId>springfox-swagger2</artifactId>
  </dependency>
  <dependency>
      <groupId>io.springfox</groupId>
      <artifactId>springfox-swagger-ui</artifactId>
  </dependency>
  ```

åªéœ€è¦åœ¨heima-leadnews-commonä¸­è¿›è¡Œé…ç½®å³å¯ï¼Œå› ä¸ºå…¶ä»–å¾®æœåŠ¡å·¥ç¨‹éƒ½ç›´æ¥æˆ–é—´æ¥ä¾èµ–å³å¯ã€‚

- åœ¨heima-leadnews-commonå·¥ç¨‹ä¸­æ·»åŠ ä¸€ä¸ªé…ç½®ç±»

æ–°å¢ï¼šcom.heima.common.swagger.Swagger2Configuration

```java
package com.heima.common.swagger;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
public class Swagger2Configuration {

   @Bean
   public Docket buildDocket() {
      return new Docket(DocumentationType.SWAGGER_2)
              .apiInfo(buildApiInfo())
              .select()
              // è¦æ‰«æçš„API(Controller)åŸºç¡€åŒ…
              .apis(RequestHandlerSelectors.basePackage("com.heima"))
              .paths(PathSelectors.any())
              .build();
   }

   private ApiInfo buildApiInfo() {
      Contact contact = new Contact("é»‘é©¬ç¨‹åºå‘˜","","");
      return new ApiInfoBuilder()
              .title("é»‘é©¬å¤´æ¡-å¹³å°ç®¡ç†APIæ–‡æ¡£")
              .description("é»‘é©¬å¤´æ¡åå°api")
              .contact(contact)
              .version("1.0.0").build();
   }
}
```

è”è°ƒ

åœ¨heima-leadnews-commonæ¨¡å—ä¸­çš„resourcesç›®å½•ä¸­æ–°å¢ä»¥ä¸‹ç›®å½•å’Œæ–‡ä»¶

æ–‡ä»¶ï¼šresources/META-INF/Spring.factories

```java
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  com.heima.common.swagger.Swagger2Configuration
```

ï¼ˆ3ï¼‰Swaggerå¸¸ç”¨æ³¨è§£

åœ¨Javaç±»ä¸­æ·»åŠ Swaggerçš„æ³¨è§£å³å¯ç”ŸæˆSwaggeræ¥å£æ–‡æ¡£ï¼Œå¸¸ç”¨Swaggeræ³¨è§£å¦‚ä¸‹ï¼š

@Apiï¼šä¿®é¥°æ•´ä¸ªç±»ï¼Œæè¿°Controllerçš„ä½œç”¨  

@ApiOperationï¼šæè¿°ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ–è€…è¯´ä¸€ä¸ªæ¥å£  

@ApiParamï¼šå•ä¸ªå‚æ•°çš„æè¿°ä¿¡æ¯  

@ApiModelï¼šç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•°  

@ApiModelPropertyï¼šç”¨å¯¹è±¡æ¥æ”¶å‚æ•°æ—¶ï¼Œæè¿°å¯¹è±¡çš„ä¸€ä¸ªå­—æ®µ  

@ApiResponseï¼šHTTPå“åº”å…¶ä¸­1ä¸ªæè¿°  

@ApiResponsesï¼šHTTPå“åº”æ•´ä½“æè¿°  

@ApiIgnoreï¼šä½¿ç”¨è¯¥æ³¨è§£å¿½ç•¥è¿™ä¸ªAPI  

@ApiError ï¼šå‘ç”Ÿé”™è¯¯è¿”å›çš„ä¿¡æ¯  

@ApiImplicitParamï¼šä¸€ä¸ªè¯·æ±‚å‚æ•°  

@ApiImplicitParamsï¼šå¤šä¸ªè¯·æ±‚å‚æ•°çš„æè¿°ä¿¡æ¯



 @ApiImplicitParamå±æ€§ï¼š

| å±æ€§         | å–å€¼   | ä½œç”¨                                          |
| ------------ | ------ | --------------------------------------------- |
| paramType    |        | æŸ¥è¯¢å‚æ•°ç±»å‹                                  |
|              | path   | ä»¥åœ°å€çš„å½¢å¼æäº¤æ•°æ®                          |
|              | query  | ç›´æ¥è·Ÿå‚æ•°å®Œæˆè‡ªåŠ¨æ˜ å°„èµ‹å€¼                    |
|              | body   | ä»¥æµçš„å½¢å¼æäº¤ ä»…æ”¯æŒPOST                     |
|              | header | å‚æ•°åœ¨request headers é‡Œè¾¹æäº¤                |
|              | form   | ä»¥formè¡¨å•çš„å½¢å¼æäº¤ ä»…æ”¯æŒPOST               |
| dataType     |        | å‚æ•°çš„æ•°æ®ç±»å‹ åªä½œä¸ºæ ‡å¿—è¯´æ˜ï¼Œå¹¶æ²¡æœ‰å®é™…éªŒè¯ |
|              | Long   |                                               |
|              | String |                                               |
| name         |        | æ¥æ”¶å‚æ•°å                                    |
| value        |        | æ¥æ”¶å‚æ•°çš„æ„ä¹‰æè¿°                            |
| required     |        | å‚æ•°æ˜¯å¦å¿…å¡«                                  |
|              | true   | å¿…å¡«                                          |
|              | false  | éå¿…å¡«                                        |
| defaultValue |        | é»˜è®¤å€¼                                        |

æˆ‘ä»¬åœ¨ApUserLoginControllerä¸­æ·»åŠ Swaggeræ³¨è§£ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@RestController
@RequestMapping("/api/v1/login")
@Api(value = "appç«¯ç”¨æˆ·ç™»å½•", tags = "ap_user", description = "appç«¯ç”¨æˆ·ç™»å½•API")
public class ApUserLoginController {

    @Autowired
    private ApUserService apUserService;

    @PostMapping("/login_auth")
    @ApiOperation("ç”¨æˆ·ç™»å½•")
    public ResponseResult login(@RequestBody LoginDto dto){
        return apUserService.login(dto);
    }
}
```

LoginDto

```java
@Data
public class LoginDto {

    /**
     * æ‰‹æœºå·
     */
    @ApiModelProperty(value="æ‰‹æœºå·",required = true)
    private String phone;

    /**
     * å¯†ç 
     */
    @ApiModelProperty(value="å¯†ç ",required = true)
    private String password;
}
```

### knife4j

ä»¥ä¸‹éƒ¨åˆ†ç†Ÿæ‚‰å³å¯ï¼Œæ— éœ€æ‰‹åŠ¨å†æ¬¡é…ç½®ï¼ŒåŸºç¡€å·¥ç¨‹ä¸­å·²ç»é…ç½®å¥½äº†ã€‚

(1)ç®€ä»‹

knife4jæ˜¯ä¸ºJava MVCæ¡†æ¶é›†æˆSwaggerç”ŸæˆApiæ–‡æ¡£çš„å¢å¼ºè§£å†³æ–¹æ¡ˆ,å‰èº«æ˜¯swagger-bootstrap-ui,å–åkni4jæ˜¯å¸Œæœ›å®ƒèƒ½åƒä¸€æŠŠåŒ•é¦–ä¸€æ ·å°å·§,è½»é‡,å¹¶ä¸”åŠŸèƒ½å¼ºæ‚!

giteeåœ°å€ï¼šhttps://gitee.com/xiaoym/knife4j

å®˜æ–¹æ–‡æ¡£ï¼šhttps://doc.xiaominfo.com/

æ•ˆæœæ¼”ç¤ºï¼šhttp://knife4j.xiaominfo.com/doc.html

(2)æ ¸å¿ƒåŠŸèƒ½

è¯¥UIå¢å¼ºåŒ…ä¸»è¦åŒ…æ‹¬ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼šæ–‡æ¡£è¯´æ˜ å’Œ åœ¨çº¿è°ƒè¯•

- æ–‡æ¡£è¯´æ˜ï¼šæ ¹æ®Swaggerçš„è§„èŒƒè¯´æ˜ï¼Œè¯¦ç»†åˆ—å‡ºæ¥å£æ–‡æ¡£çš„è¯´æ˜ï¼ŒåŒ…æ‹¬æ¥å£åœ°å€ã€ç±»å‹ã€è¯·æ±‚ç¤ºä¾‹ã€è¯·æ±‚å‚æ•°ã€å“åº”ç¤ºä¾‹ã€å“åº”å‚æ•°ã€å“åº”ç ç­‰ä¿¡æ¯ï¼Œä½¿ç”¨swagger-bootstrap-uièƒ½æ ¹æ®è¯¥æ–‡æ¡£è¯´æ˜ï¼Œå¯¹è¯¥æ¥å£çš„ä½¿ç”¨æƒ…å†µä¸€ç›®äº†ç„¶ã€‚
- åœ¨çº¿è°ƒè¯•ï¼šæä¾›åœ¨çº¿æ¥å£è”è°ƒçš„å¼ºå¤§åŠŸèƒ½ï¼Œè‡ªåŠ¨è§£æå½“å‰æ¥å£å‚æ•°,åŒæ—¶åŒ…å«è¡¨å•éªŒè¯ï¼Œè°ƒç”¨å‚æ•°å¯è¿”å›æ¥å£å“åº”å†…å®¹ã€headersã€Curlè¯·æ±‚å‘½ä»¤å®ä¾‹ã€å“åº”æ—¶é—´ã€å“åº”çŠ¶æ€ç ç­‰ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨çº¿è°ƒè¯•ï¼Œè€Œä¸å¿…é€šè¿‡å…¶ä»–æµ‹è¯•å·¥å…·æµ‹è¯•æ¥å£æ˜¯å¦æ­£ç¡®,ç®€ä»‹ã€å¼ºå¤§ã€‚
- ä¸ªæ€§åŒ–é…ç½®ï¼šé€šè¿‡ä¸ªæ€§åŒ–uié…ç½®é¡¹ï¼Œå¯è‡ªå®šä¹‰UIçš„ç›¸å…³æ˜¾ç¤ºä¿¡æ¯
- ç¦»çº¿æ–‡æ¡£ï¼šæ ¹æ®æ ‡å‡†è§„èŒƒï¼Œç”Ÿæˆçš„åœ¨çº¿markdownç¦»çº¿æ–‡æ¡£ï¼Œå¼€å‘è€…å¯ä»¥è¿›è¡Œæ‹·è´ç”Ÿæˆmarkdownæ¥å£æ–‡æ¡£ï¼Œé€šè¿‡å…¶ä»–ç¬¬ä¸‰æ–¹markdownè½¬æ¢å·¥å…·è½¬æ¢æˆhtmlæˆ–pdfï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ”¾å¼ƒswagger2markdownç»„ä»¶
- æ¥å£æ’åºï¼šè‡ª1.8.5åï¼Œuiæ”¯æŒäº†æ¥å£æ’åºåŠŸèƒ½ï¼Œä¾‹å¦‚ä¸€ä¸ªæ³¨å†ŒåŠŸèƒ½ä¸»è¦åŒ…å«äº†å¤šä¸ªæ­¥éª¤,å¯ä»¥æ ¹æ®swagger-bootstrap-uiæä¾›çš„æ¥å£æ’åºè§„åˆ™å®ç°æ¥å£çš„æ’åºï¼ŒstepåŒ–æ¥å£æ“ä½œï¼Œæ–¹ä¾¿å…¶ä»–å¼€å‘è€…è¿›è¡Œæ¥å£å¯¹æ¥

(3)å¿«é€Ÿé›†æˆ

- åœ¨heima-leadnews-commonæ¨¡å—ä¸­çš„`pom.xml`æ–‡ä»¶ä¸­å¼•å…¥`knife4j`çš„ä¾èµ–,å¦‚ä¸‹ï¼š

```xml
<dependency>
     <groupId>com.github.xiaoymin</groupId>
     <artifactId>knife4j-spring-boot-starter</artifactId>
</dependency>
```

- åˆ›å»ºSwaggeré…ç½®æ–‡ä»¶

åœ¨heima-leadnews-commonçš„Swagger2Configurationä¸­è¡¥ä¸Š

![image-20221231214223188](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2022/12/31_21_42_23_image-20221231214223188.png)

ä»¥ä¸Šæœ‰ä¸¤ä¸ªæ³¨è§£éœ€è¦ç‰¹åˆ«è¯´æ˜ï¼Œå¦‚ä¸‹è¡¨ï¼š

| æ³¨è§£              | è¯´æ˜                                                         |
| ----------------- | ------------------------------------------------------------ |
| `@EnableSwagger2` | è¯¥æ³¨è§£æ˜¯Springfox-swaggeræ¡†æ¶æä¾›çš„ä½¿ç”¨Swaggeræ³¨è§£ï¼Œè¯¥æ³¨è§£å¿…é¡»åŠ  |
| `@EnableKnife4j`  | è¯¥æ³¨è§£æ˜¯`knife4j`æä¾›çš„å¢å¼ºæ³¨è§£,Uiæä¾›äº†ä¾‹å¦‚åŠ¨æ€å‚æ•°ã€å‚æ•°è¿‡æ»¤ã€æ¥å£æ’åºç­‰å¢å¼ºåŠŸèƒ½,å¦‚æœä½ æƒ³ä½¿ç”¨è¿™äº›å¢å¼ºåŠŸèƒ½å°±å¿…é¡»åŠ è¯¥æ³¨è§£ï¼Œå¦åˆ™å¯ä»¥ä¸ç”¨åŠ  |

- è®¿é—®

åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ï¼š`http://ip:port/doc.html`

## 1.3 gatewayç½‘å…³

**è™šæ‹Ÿç½‘å¡å°±æ˜¯æœ¬åœ°ï¼ˆlocalhostï¼‰ï¼Œnginxåœ¨è™šæ‹Ÿæœºï¼ˆ192.168.200.130ï¼‰é€šè¿‡è™šæ‹Ÿç½‘å¡ç»‘å®šåœ¨æœ¬åœ°ç”µè„‘ä¸Š æ‰€ä»¥ç›´æ¥è®¿é—®150å°±å¯ä»¥è®¿é—®åˆ°æœåŠ¡**

**130æ˜¯è™šæ‹Ÿæœºip  150å¯¹äºè™šæ‹Ÿæœºæ˜¯ç”µè„‘ip**

## 1.4 FreeMakeræ¨¡æ¿å¼•æ“

â€‹	FreeMarker æ˜¯ä¸€æ¬¾ æ¨¡æ¿å¼•æ“ï¼š å³ä¸€ç§åŸºäºæ¨¡æ¿å’Œè¦æ”¹å˜çš„æ•°æ®ï¼Œ å¹¶ç”¨æ¥ç”Ÿæˆè¾“å‡ºæ–‡æœ¬(HTMLç½‘é¡µï¼Œç”µå­é‚®ä»¶ï¼Œé…ç½®æ–‡ä»¶ï¼Œæºä»£ç ç­‰)çš„é€šç”¨å·¥å…·ã€‚ å®ƒä¸æ˜¯é¢å‘æœ€ç»ˆç”¨æˆ·çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªJavaç±»åº“ï¼Œæ˜¯ä¸€æ¬¾ç¨‹åºå‘˜å¯ä»¥åµŒå…¥ä»–ä»¬æ‰€å¼€å‘äº§å“çš„ç»„ä»¶ã€‚

![image-20221231214917986](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2022/12/31_21_49_18_image-20221231214917986.png)

å¸¸ç”¨çš„javaæ¨¡æ¿å¼•æ“è¿˜æœ‰å“ªäº›ï¼Ÿ

Jspã€Freemarkerã€Thymeleaf ã€Velocity ç­‰ã€‚

1.Jsp ä¸º Servlet ä¸“ç”¨ï¼Œä¸èƒ½å•ç‹¬è¿›è¡Œä½¿ç”¨ã€‚

2.Thymeleaf ä¸ºæ–°æŠ€æœ¯ï¼ŒåŠŸèƒ½è¾ƒä¸ºå¼ºå¤§ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ•ˆç‡æ¯”è¾ƒä½ã€‚

3.Velocityä»2010å¹´æ›´æ–°å®Œ 2.0 ç‰ˆæœ¬åï¼Œä¾¿æ²¡æœ‰åœ¨æ›´æ–°ã€‚Spring Boot å®˜æ–¹åœ¨ 1.4 ç‰ˆæœ¬åå¯¹æ­¤ä¹Ÿä¸åœ¨æ”¯æŒï¼Œè™½ç„¶ Velocity åœ¨ 2017 å¹´ç‰ˆæœ¬å¾—åˆ°è¿­ä»£ï¼Œä½†ä¸ºæ—¶å·²æ™šã€‚ 

##### ä½¿ç”¨

1 freemarkerä¾èµ–åŒ…è¯´æ˜

```yaml
<dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-freemarker</artifactId>
    </dependency>
```



2  freemarkeré…ç½®application.ymlè¯´æ˜

```yaml
 port: 8881 #æœåŠ¡ç«¯å£
spring:
  application:
    name: freemarker-demo #æŒ‡å®šæœåŠ¡å
  freemarker:
    cache: false  #å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•
    settings:
      template_update_delay: 0 #æ£€æŸ¥æ¨¡æ¿æ›´æ–°å»¶è¿Ÿæ—¶é—´ï¼Œè®¾ç½®ä¸º0è¡¨ç¤ºç«‹å³æ£€æŸ¥ï¼Œå¦‚æœæ—¶é—´å¤§äº0ä¼šæœ‰ç¼“å­˜ä¸æ–¹ä¾¿è¿›è¡Œæ¨¡æ¿æµ‹è¯•
    suffix: .ftl               #æŒ‡å®šFreemarkeræ¨¡æ¿æ–‡ä»¶çš„åç¼€å
    template-loader-path: classpath:/templates   #æ¨¡æ¿å­˜æ”¾ä½ç½®n;
```



3 åœ¨resources templates   01-basic.ftl å†…å®¹å¦‚ä¸‹

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hello World!</title>
</head>
<body>
<b>æ™®é€šæ–‡æœ¬ String å±•ç¤ºï¼š</b><br><br>
Hello ${name} <br>
<hr>
<b>å¯¹è±¡Studentä¸­çš„æ•°æ®å±•ç¤ºï¼š</b><br/>
å§“åï¼š${stu.name}<br/>
å¹´é¾„ï¼š${stu.age}
<hr>
</body>
</html>
```

4 å¿«é€Ÿæµ‹è¯•ä½“éªŒ

å¯åŠ¨freemarker-demo å·¥ç¨‹ä¸­ FreemarkerDemoApplicationç±»

è¯·æ±‚ï¼šhttp://localhost:8881/basic

![image-20221231215110126](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2022/12/31_21_51_10_image-20221231215110126.png)

### freemarkerè¯­æ³•æ€»ç»“

#### åŸºç¡€è¯­æ³•ç§ç±»

  1ã€æ³¨é‡Šï¼Œå³<#--  -->ï¼Œä»‹äºå…¶ä¹‹é—´çš„å†…å®¹ä¼šè¢«freemarkerå¿½ç•¥

```velocity
<#--æˆ‘æ˜¯ä¸€ä¸ªfreemarkeræ³¨é‡Š-->
```

  2ã€æ’å€¼ï¼ˆInterpolationï¼‰ï¼šå³ **`${..}`** éƒ¨åˆ†,freemarkerä¼šç”¨çœŸå®çš„å€¼ä»£æ›¿**`${..}`**

```velocity
Hello ${name}
```

  3ã€FTLæŒ‡ä»¤ï¼šå’ŒHTMLæ ‡è®°ç±»ä¼¼ï¼Œåå­—å‰åŠ #äºˆä»¥åŒºåˆ†ï¼ŒFreemarkerä¼šè§£ææ ‡ç­¾ä¸­çš„è¡¨è¾¾å¼æˆ–é€»è¾‘ã€‚

```velocity
<# >FTLæŒ‡ä»¤</#> 
```

  4ã€æ–‡æœ¬ï¼Œä»…æ–‡æœ¬ä¿¡æ¯ï¼Œè¿™äº›ä¸æ˜¯freemarkerçš„æ³¨é‡Šã€æ’å€¼ã€FTLæŒ‡ä»¤çš„å†…å®¹ä¼šè¢«freemarkerå¿½ç•¥è§£æï¼Œç›´æ¥è¾“å‡ºå†…å®¹ã€‚

```velocity
<#--freemarkerä¸­çš„æ™®é€šæ–‡æœ¬-->
æˆ‘æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–‡æœ¬
```

#### é›†åˆæŒ‡ä»¤ï¼ˆListå’ŒMapï¼‰

æ•°æ®æ¨¡å‹ï¼š

åœ¨HelloControllerä¸­æ–°å¢å¦‚ä¸‹æ–¹æ³•ï¼š

```java
@GetMapping("/list")
public String list(Model model){

    //------------------------------------
    Student stu1 = new Student();
    stu1.setName("å°å¼º");
    stu1.setAge(18);
    stu1.setMoney(1000.86f);
    stu1.setBirthday(new Date());

    //å°çº¢å¯¹è±¡æ¨¡å‹æ•°æ®
    Student stu2 = new Student();
    stu2.setName("å°çº¢");
    stu2.setMoney(200.1f);
    stu2.setAge(19);

    //å°†ä¸¤ä¸ªå¯¹è±¡æ¨¡å‹æ•°æ®å­˜æ”¾åˆ°Listé›†åˆä¸­
    List<Student> stus = new ArrayList<>();
    stus.add(stu1);
    stus.add(stu2);

    //å‘modelä¸­å­˜æ”¾Listé›†åˆæ•°æ®
    model.addAttribute("stus",stus);

    //------------------------------------

    //åˆ›å»ºMapæ•°æ®
    HashMap<String,Student> stuMap = new HashMap<>();
    stuMap.put("stu1",stu1);
    stuMap.put("stu2",stu2);
    // 3.1 å‘modelä¸­å­˜æ”¾Mapæ•°æ®
    model.addAttribute("stuMap", stuMap);

    return "02-list";
}
```

2ã€æ¨¡æ¿ï¼š

åœ¨templatesä¸­æ–°å¢`02-list.ftl`æ–‡ä»¶

å®ä¾‹ä»£ç ï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hello World!</title>
</head>
<body>
    
<#-- list æ•°æ®çš„å±•ç¤º -->
<b>å±•ç¤ºlistä¸­çš„stuæ•°æ®:</b>
<br>
<br>
<table>
    <tr>
        <td>åºå·</td>
        <td>å§“å</td>
        <td>å¹´é¾„</td>
        <td>é’±åŒ…</td>
    </tr>
    <#list stus as stu>
        <tr>
            <td>${stu_index+1}</td>
            <td>${stu.name}</td>
            <td>${stu.age}</td>
            <td>${stu.money}</td>
        </tr>
    </#list>

</table>
<hr>
    
<#-- Map æ•°æ®çš„å±•ç¤º -->
<b>mapæ•°æ®çš„å±•ç¤ºï¼š</b>
<br/><br/>
<a href="###">æ–¹å¼ä¸€ï¼šé€šè¿‡map['keyname'].property</a><br/>
è¾“å‡ºstu1çš„å­¦ç”Ÿä¿¡æ¯ï¼š<br/>
å§“åï¼š${stuMap['stu1'].name}<br/>
å¹´é¾„ï¼š${stuMap['stu1'].age}<br/>
<br/>
<a href="###">æ–¹å¼äºŒï¼šé€šè¿‡map.keyname.property</a><br/>
è¾“å‡ºstu2çš„å­¦ç”Ÿä¿¡æ¯ï¼š<br/>
å§“åï¼š${stuMap.stu2.name}<br/>
å¹´é¾„ï¼š${stuMap.stu2.age}<br/>

<br/>
<a href="###">éå†mapä¸­ä¸¤ä¸ªå­¦ç”Ÿä¿¡æ¯ï¼š</a><br/>
<table>
    <tr>
        <td>åºå·</td>
        <td>å§“å</td>
        <td>å¹´é¾„</td>
        <td>é’±åŒ…</td>
    </tr>
    <#list stuMap?keys as key >
        <tr>
            <td>${key_index}</td>
            <td>${stuMap[key].name}</td>
            <td>${stuMap[key].age}</td>
            <td>${stuMap[key].money}</td>
        </tr>
    </#list>
</table>
<hr>
 
</body>
</html>
```

ğŸ‘†ä¸Šé¢ä»£ç è§£é‡Šï¼š

${k_index}ï¼š
	indexï¼šå¾—åˆ°å¾ªç¯çš„ä¸‹æ ‡ï¼Œä½¿ç”¨æ–¹æ³•æ˜¯åœ¨stuåè¾¹åŠ "_index"ï¼Œå®ƒçš„å€¼æ˜¯ä»0å¼€å§‹

#### ifæŒ‡ä»¤

â€‹	 if æŒ‡ä»¤å³åˆ¤æ–­æŒ‡ä»¤ï¼Œæ˜¯å¸¸ç”¨çš„FTLæŒ‡ä»¤ï¼Œfreemarkeråœ¨è§£ææ—¶é‡åˆ°ifä¼šè¿›è¡Œåˆ¤æ–­ï¼Œæ¡ä»¶ä¸ºçœŸåˆ™è¾“å‡ºifä¸­é—´çš„å†…å®¹ï¼Œå¦åˆ™è·³è¿‡å†…å®¹ä¸å†è¾“å‡ºã€‚

- æŒ‡ä»¤æ ¼å¼

```html
<#if ></if>

<#list stus as stu >
        <#if stu.name='å°çº¢'>
            <tr style="color: red">
                <td>${stu_index}</td>
                <td>${stu.name}</td>
                <td>${stu.age}</td>
                <td>${stu.money}</td>
            </tr>
            <#else >
            <tr>
                <td>${stu_index}</td>
                <td>${stu.name}</td>
                <td>${stu.age}</td>
                <td>${stu.money}</td>
            </tr>
        </#if>
    </#list>
```

#### è¿ç®—ç¬¦

**1ã€ç®—æ•°è¿ç®—ç¬¦**

FreeMarkerè¡¨è¾¾å¼ä¸­å®Œå…¨æ”¯æŒç®—æœ¯è¿ç®—,FreeMarkeræ”¯æŒçš„ç®—æœ¯è¿ç®—ç¬¦åŒ…æ‹¬:

- åŠ æ³•ï¼š `+`
- å‡æ³•ï¼š `-`
- ä¹˜æ³•ï¼š `*`
- é™¤æ³•ï¼š `/`
- æ±‚æ¨¡ (æ±‚ä½™)ï¼š `%`



æ¨¡æ¿ä»£ç 

```html
<b>ç®—æ•°è¿ç®—ç¬¦</b>
<br/><br/>
    100+5 è¿ç®—ï¼š  ${100 + 5 }<br/>
    100 - 5 * 5è¿ç®—ï¼š${100 - 5 * 5}<br/>
    5 / 2è¿ç®—ï¼š${5 / 2}<br/>
    12 % 10è¿ç®—ï¼š${12 % 10}<br/>
<hr>
```

é™¤äº† + è¿ç®—ä»¥å¤–ï¼Œå…¶ä»–çš„è¿ç®—åªèƒ½å’Œ number æ•°å­—ç±»å‹çš„è®¡ç®—ã€‚







**2ã€æ¯”è¾ƒè¿ç®—ç¬¦**

- **`=`**æˆ–è€…**`==`**:åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰. 
- **`!=`**:åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸ç­‰. 
- **`>`**æˆ–è€…**`gt`**:åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºå³è¾¹å€¼ 
- **`>=`**æˆ–è€…**`gte`**:åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºç­‰äºå³è¾¹å€¼ 
- **`<`**æˆ–è€…**`lt`**:åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºå³è¾¹å€¼ 
- **`<=`**æˆ–è€…**`lte`**:åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºç­‰äºå³è¾¹å€¼ 



= å’Œ == æ¨¡æ¿ä»£ç 

```
<body>

    <b>æ¯”è¾ƒè¿ç®—ç¬¦</b>
    <br/>
    <br/>

    <dl>
        <dt> =/== å’Œ != æ¯”è¾ƒï¼š</dt>
        <dd>
            <#if "xiaoming" == "xiaoming">
                å­—ç¬¦ä¸²çš„æ¯”è¾ƒ "xiaoming" == "xiaoming"
            </#if>
        </dd>
        <dd>
            <#if 10 != 100>
                æ•°å€¼çš„æ¯”è¾ƒ 10 != 100
            </#if>
        </dd>
    </dl>



    <dl>
        <dt>å…¶ä»–æ¯”è¾ƒ</dt>
        <dd>
            <#if 10 gt 5 >
                å½¢å¼ä¸€ï¼šä½¿ç”¨ç‰¹æ®Šå­—ç¬¦æ¯”è¾ƒæ•°å€¼ 10 gt 5
            </#if>
        </dd>
        <dd>
            <#-- æ—¥æœŸçš„æ¯”è¾ƒéœ€è¦é€šè¿‡?dateå°†å±æ€§è½¬ä¸ºdataç±»å‹æ‰èƒ½è¿›è¡Œæ¯”è¾ƒ -->
            <#if (date1?date >= date2?date)>
                å½¢å¼äºŒï¼šä½¿ç”¨æ‹¬å·å½¢å¼æ¯”è¾ƒæ—¶é—´ date1?date >= date2?date
            </#if>
        </dd>
    </dl>

    <br/>
<hr>
</body>
```

Controller çš„ æ•°æ®æ¨¡å‹ä»£ç 

```java
@GetMapping("operation")
public String testOperation(Model model) {
    //æ„å»º Date æ•°æ®
    Date now = new Date();
    model.addAttribute("date1", now);
    model.addAttribute("date2", now);
    
    return "03-operation";
}
```

**æ¯”è¾ƒè¿ç®—ç¬¦æ³¨æ„**

- **`=`**å’Œ**`!=`**å¯ä»¥ç”¨äºå­—ç¬¦ä¸²ã€æ•°å€¼å’Œæ—¥æœŸæ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰
- **`=`**å’Œ**`!=`**ä¸¤è¾¹å¿…é¡»æ˜¯ç›¸åŒç±»å‹çš„å€¼,å¦åˆ™ä¼šäº§ç”Ÿé”™è¯¯
- å­—ç¬¦ä¸² **`"x"`** ã€**`"x "`** ã€**`"X"`**æ¯”è¾ƒæ˜¯ä¸ç­‰çš„.å› ä¸ºFreeMarkeræ˜¯ç²¾ç¡®æ¯”è¾ƒ
- å…¶å®ƒçš„è¿è¡Œç¬¦å¯ä»¥ä½œç”¨äºæ•°å­—å’Œæ—¥æœŸ,ä½†ä¸èƒ½ä½œç”¨äºå­—ç¬¦ä¸²
- ä½¿ç”¨**`gt`**ç­‰å­—æ¯è¿ç®—ç¬¦ä»£æ›¿**`>`**ä¼šæœ‰æ›´å¥½çš„æ•ˆæœ,å› ä¸º FreeMarkerä¼šæŠŠ**`>`**è§£é‡ŠæˆFTLæ ‡ç­¾çš„ç»“æŸå­—ç¬¦
- å¯ä»¥ä½¿ç”¨æ‹¬å·æ¥é¿å…è¿™ç§æƒ…å†µ,å¦‚:**`<#if (x>y)>`**



3ã€é€»è¾‘è¿ç®—ç¬¦**

- é€»è¾‘ä¸:&& 
- é€»è¾‘æˆ–:|| 
- é€»è¾‘é:! 

é€»è¾‘è¿ç®—ç¬¦åªèƒ½ä½œç”¨äºå¸ƒå°”å€¼,å¦åˆ™å°†äº§ç”Ÿé”™è¯¯ ã€‚



#### ç©ºå€¼å¤„ç†

**1ã€åˆ¤æ–­æŸå˜é‡æ˜¯å¦å­˜åœ¨ä½¿ç”¨ â€œ??â€**

ç”¨æ³•ä¸º:variable??,å¦‚æœè¯¥å˜é‡å­˜åœ¨,è¿”å›true,å¦åˆ™è¿”å›false 

ä¾‹ï¼šä¸ºé˜²æ­¢stusä¸ºç©ºæŠ¥é”™å¯ä»¥åŠ ä¸Šåˆ¤æ–­å¦‚ä¸‹ï¼š

```velocity
    <#if stus??>
    <#list stus as stu>
    	......
    </#list>
    </#if>
```



**2ã€ç¼ºå¤±å˜é‡é»˜è®¤å€¼ä½¿ç”¨ â€œ!â€**

- ä½¿ç”¨!è¦ä»¥æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ï¼Œå½“å˜é‡ä¸ºç©ºæ—¶æ˜¾ç¤ºé»˜è®¤å€¼

  ä¾‹ï¼š  ${name!''}è¡¨ç¤ºå¦‚æœnameä¸ºç©ºæ˜¾ç¤ºç©ºå­—ç¬¦ä¸²ã€‚



- å¦‚æœæ˜¯åµŒå¥—å¯¹è±¡åˆ™å»ºè®®ä½¿ç”¨ï¼ˆï¼‰æ‹¬èµ·æ¥

  ä¾‹ï¼š ${(stu.bestFriend.name)!''}è¡¨ç¤ºï¼Œå¦‚æœstuæˆ–bestFriendæˆ–nameä¸ºç©ºé»˜è®¤æ˜¾ç¤ºç©ºå­—ç¬¦ä¸²ã€‚

#### å†…å»ºå‡½æ•°

å†…å»ºå‡½æ•°è¯­æ³•æ ¼å¼ï¼š **`å˜é‡+?+å‡½æ•°åç§°`**  

**1ã€å’Œåˆ°æŸä¸ªé›†åˆçš„å¤§å°**

**`${é›†åˆå?size}`**



**2ã€æ—¥æœŸæ ¼å¼åŒ–**

æ˜¾ç¤ºå¹´æœˆæ—¥: **`${today?date}`** 
æ˜¾ç¤ºæ—¶åˆ†ç§’ï¼š**`${today?time}`**   
æ˜¾ç¤ºæ—¥æœŸ+æ—¶é—´ï¼š**`${today?datetime}`**   
è‡ªå®šä¹‰æ ¼å¼åŒ–ï¼š  **`${today?string("yyyyå¹´MMæœˆ")}`**



**3ã€å†…å»ºå‡½æ•°`c`**

model.addAttribute("point", 102920122);

pointæ˜¯æ•°å­—å‹ï¼Œä½¿ç”¨${point}ä¼šæ˜¾ç¤ºè¿™ä¸ªæ•°å­—çš„å€¼ï¼Œæ¯ä¸‰ä½ä½¿ç”¨é€—å·åˆ†éš”ã€‚

å¦‚æœä¸æƒ³æ˜¾ç¤ºä¸ºæ¯ä¸‰ä½åˆ†éš”çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨cå‡½æ•°å°†æ•°å­—å‹è½¬æˆå­—ç¬¦ä¸²è¾“å‡º

**`${point?c}`**

**4ã€å°†jsonå­—ç¬¦ä¸²è½¬æˆå¯¹è±¡**

ä¸€ä¸ªä¾‹å­ï¼š

å…¶ä¸­ç”¨åˆ°äº† assignæ ‡ç­¾ï¼Œassignçš„ä½œç”¨æ˜¯å®šä¹‰ä¸€ä¸ªå˜é‡ã€‚

```velocity
<#assign text="{'bank':'å·¥å•†é“¶è¡Œ','account':'10101920201920212'}" />
<#assign data=text?eval />
å¼€æˆ·è¡Œï¼š${data.bank}  è´¦å·ï¼š${data.account}
```

### ä½¿ç”¨

å¯¼å…¥ä¾èµ–

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-freemarker</artifactId>
</dependency>
```

ä¿®æ”¹é…ç½®

```yaml
spring
  freemarker:
    cache: false  #å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•
    settings:
      template_update_delay: 0 #æ£€æŸ¥æ¨¡æ¿æ›´æ–°å»¶è¿Ÿæ—¶é—´ï¼Œè®¾ç½®ä¸º0è¡¨ç¤ºç«‹å³æ£€æŸ¥ï¼Œå¦‚æœæ—¶é—´å¤§äº0ä¼šæœ‰ç¼“å­˜ä¸æ–¹ä¾¿è¿›è¡Œæ¨¡æ¿æµ‹è¯•
    suffix: .ftl               #æŒ‡å®šFreemarkeræ¨¡æ¿æ–‡ä»¶çš„åç¼€å
    template-loader-path: classpath:/templates
    
# freemarkeræ¨¡æ¿æ–‡ä»¶é€šå¸¸éƒ½æ˜¯ä»¥ftlä½œä¸ºæ‰©å±•å,ä¹Ÿå¯ä»¥ä¸ºhtmlã€xmlã€jspç­‰

```

ä½¿ç”¨import freemarker.template.Configuration;æ¥è·å–æ¨¡æ¿

åˆæˆ
        //ç¬¬ä¸€ä¸ªå‚æ•° æ•°æ®æ¨¡å‹
        //ç¬¬äºŒä¸ªå‚æ•°  è¾“å‡ºæµ
        template.process(params, new FileWriter("d:/list.html"));



## 1.5MinIOå¯¹è±¡å­˜å‚¨æœåŠ¡

æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨æŠ€æœ¯

#### ä½¿ç”¨åŸå› ï¼š

å°†é™æ€æ–‡ä»¶æ”¾åœ¨ä¸“ç”¨çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜è¿è¡ŒæœåŠ¡å™¨çš„å¸¦å®½ï¼Œæ€§èƒ½

##### å…³é”®å­—ï¼š

1. Bubcketï¼šæ ¹ç›®å½•
2. Obejectï¼šå¯¹è±¡æ–‡ä»¶
3. Keysï¼šæ–‡ä»¶å
4. AccessKeyï¼šç™»å½•è´¦å·
5. SecretKeyï¼šç™»å½•å¯†ç 

#### ä½¿ç”¨æ–¹æ³•ï¼š

æ·»åŠ ä¾èµ–

```xml
        <dependency>
            <groupId>com.heima</groupId>
            <artifactId>heima-file-starter</artifactId>
            <version>1.0-SNAPSHOT</version>
         </dependency>
  
```

ä¿®æ”¹é…ç½®

```yaml
minio:
  accessKey: minio
  secretKey: minio123
  bucket: leadnews
  endpoint: http://192.168.200.130:9000
  readPath: http://192.168.200.130:9000
```

åˆ›å»ºæ–¹æ³•ï¼Œå°†æ–‡ä»¶ä¸Šä¼ åˆ°minioæœåŠ¡å™¨

```java
    /**
     *  ä¸Šä¼ htmlæ–‡ä»¶
     * @param prefix  æ–‡ä»¶å‰ç¼€
     * @param filename   æ–‡ä»¶å
     * @param inputStream  æ–‡ä»¶æµ
     * @return  æ–‡ä»¶å…¨è·¯å¾„
     */
    @Override
    public String uploadHtmlFile(String prefix, String filename,InputStream inputStream) {
        String filePath = builderFilePath(prefix, filename);
        try {
            PutObjectArgs putObjectArgs = PutObjectArgs.builder()
                    .object(filePath)
                    .contentType("text/html")
                    .bucket(minIOConfigProperties.getBucket()).stream(inputStream,inputStream.available(),-1)
                    .build();
            minioClient.putObject(putObjectArgs);
            StringBuilder urlPath = new StringBuilder(minIOConfigProperties.getReadPath());
            urlPath.append(separator+minIOConfigProperties.getBucket());
            urlPath.append(separator);
            urlPath.append(filePath);
            return urlPath.toString();
        }catch (Exception ex){
            log.error("minio put file error.",ex);
            ex.printStackTrace();
            throw new RuntimeException("ä¸Šä¼ æ–‡ä»¶å¤±è´¥");
        }
    }
```

å¦‚æœä¸Šä¼ å‡ºç°ä¸€ä¸‹å¼‚å¸¸ï¼š

``````
io.minio.errors.ErrorResponseException: The difference between the request time and the server's time is too large.
``````

é‚£ä¹ˆè§£å†³åŠæ³•å°±æ˜¯ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ï¼š

``````
ntpdate cn.pool.ntp.org
``````

å•ç‹¬æ‰§è¡Œå¦‚ä¸Šå‘½ä»¤ï¼Œåªèƒ½ä¸´æ—¶è§£å†³æ—¶é—´åŒæ­¥ï¼Œå¦‚æœå¸Œæœ›æ¯æ¬¡å¼€å¯è™šæ‹Ÿæœºéƒ½åŒæ­¥æ—¶é—´ï¼Œéœ€è¦å°†æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š

1. ç¼–è¾‘   vim /etc/rc.localï¼Œå°†å‘½ä»¤ntpdate cn.pool.ntp.orgæ·»åŠ åˆ°æœ€åä¸€è¡Œ

   ``````shell
   vim /etc/rc.local
   ``````

   ![image-20221231220624619](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2022/12/31_22_6_24_image-20221231220624619.png)

2. ç»™rc.localæ·»åŠ æ‰§è¡Œæƒé™

   ``````shell
   chmod +x /etc/rc.d/rc.local
   ``````

3. æ‰§è¡Œå‘½ä»¤rebooté‡å¯ç³»ç»Ÿï¼Œå‘ç°æ—¶é—´å¼€æœºåèƒ½ç«‹å³åŒæ­¥äº†





# è‡ªåª’ä½“ç®¡ç†ç«¯

## ä½¿ç”¨çš„æŠ€æœ¯æ ˆ

çº¿ç¨‹æ± 

OCRå›¾ç‰‡è¯†åˆ«æŠ€æœ¯ Tess4j

DFAç®—æ³•

ç¬¬ä¸‰æ–¹å†…å®¹å®¡æ ¸ç™¾åº¦äº‘å’Œé˜¿é‡Œäº‘

å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨ Feign

åˆ†å¸ƒå¼å¯¹è±¡æ–‡ä»¶å­˜å‚¨æœåŠ¡ MinIO

æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆ FreeMarker

## 1)æ–‡ç« çŠ¶æ€æŸ¥çœ‹

### éœ€æ±‚ï¼šè·å–ç”¨æˆ·ID

1. åœ¨gatewayç½‘å…³ä¸­è§£ætokençš„è´Ÿè½½å¹¶æå–å‡ºæ¥ç”¨æˆ·id
2. è‡ªå®šä¹‰ThreadLocalå·¥å…·ç±»è®¾ç½®ç”¨æˆ·id
3. ä½¿ç”¨ç”¨æˆ·idæ—¶ï¼Œåªéœ€è¦ä½¿ç”¨ThreadLocalå·¥å…·ç±»è·å–ç”¨æˆ·id

### éœ€æ±‚ï¼šè·å–å½“å‰ç”¨æˆ·ä¸‹å‘å¸ƒçš„æ‰€æœ‰æ–‡ç« 

1. æ ¹æ®æŸ¥è¯¢æ¡ä»¶è®¾ç½®SQLæŸ¥è¯¢è¯­å¥å³å¯

### 

## 2)ç´ æä¸Šä¼ 

### éœ€æ±‚ï¼šä¸Šä¼ å›¾ç‰‡

1. ä½¿ç”¨MinIOæ¥å­˜å‚¨æ–‡ä»¶

   1. **ä¸ºä»€ä¹ˆä½¿ç”¨MinIO**ï¼šå‡è½»æœåŠ¡å™¨å‹åŠ›ã€èµ„æºå ç”¨ã€æé«˜æœåŠ¡å™¨æ€§èƒ½
   2. **ä½¿ç”¨æ–¹å¼ï¼š**æŸ¥çœ‹Appç«¯æ–‡ç« æŸ¥çœ‹çš„å¯¹è±¡å­˜å‚¨æœåŠ¡MinIO

2. åˆ¤æ–­ç”¨æˆ·çš„ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹

   1. ä½¿ç”¨Hutoolså·¥å…·ç±»ä¸­çš„FileTypeUtilï¼š

   2. ```
      å¦‚æœFileTypeUtilä¸­æ²¡æœ‰æ–‡ä»¶çš„ç±»å‹ï¼Œå°±ä¼šä»¥æ–‡ä»¶åçš„åç¼€æ¥è·å–æ ¼å¼
      æ‰€ä»¥å°†æ–‡ä»¶åçš„åç¼€å»æ‰
      ```

## 3)æ–‡ç« å‘å¸ƒ



å®ç°æ€è·¯åˆ†æ

![image-20230104123011092](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2023/01/5_9_32_46_4_12_30_11_image-20230104123011092.png)

### éœ€æ±‚ï¼šåˆ¤æ–­æ˜¯å¦æœ‰ä¸»å›¾

1. å°é¢è‡ªåŠ¨åŒ¹é…è§„åˆ™ï¼š
   1. å†…å®¹ä¸­æ— å›¾->å°é¢æ— å›¾
   2. å†…å®¹ä¸­å›¾ç‰‡æ•°é‡å¤§äºç­‰äº1å°äº3æ—¶>é€‰ç¬¬ä¸€å¼ åšå°é¢
   3. å†…å®¹ä¸­å›¾ç‰‡æ•°é‡å¤§äºç­‰äº3->é€‰å‰ä¸‰å¼ åšå°é¢
2. æ ¹æ®æäº¤çŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦æ˜¯è‰ç¨¿
3. ä¿å­˜æ–‡ç« çš„å„ä¸ªå…³ç³»åˆ°è¡¨ä¸­

## 4)æ–‡ç« å®¡æ ¸

![image-20230104123610917](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2023/01/4_12_36_11_image-20230104123610917.png)

### éœ€æ±‚ï¼šæ–‡æœ¬è¿è§„ï¼Œå›¾ç‰‡è¿è§„ï¼Œå›¾ç‰‡å†…å®¹è¿è§„

![image-20230104123706881](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2023/01/4_12_37_6_image-20230104123706881.png)

![image-20230104130359284](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2023/01/4_13_3_59_image-20230104130359284.png)

1. é¦–å…ˆä½¿ç”¨DFAç®—æ³•è¿‡æ»¤æ•æ„Ÿè¯æ±‡ï¼ˆä¸æ”¶è´¹ï¼‰

   1. **å®ç°æ–¹æ³•**ï¼šæŸ¥çœ‹leadnews-uiltsä¸‹çš„SensitiveWordUtilç±»

2. ä½¿ç”¨å¼€æºå·¥å…·Tess4jè¯†åˆ«å›¾ä¸­æ–‡å­—

   1. è·å–æ–‡ç« ä¸­çš„æ‰€æœ‰å›¾ç‰‡å¹¶å»é‡

   2. ä½¿ç”¨Tess4jè¯†åˆ«å›¾ä¸­æ–‡å­—

      1. **ä½¿ç”¨æ–¹æ³•**ï¼š

         ```java
         		StringBuffer content = new StringBuffer();
                 List<byte[]> imageToByteList = getImageToByteList(wmNews, contentImageList);
                 for (byte[] bytes : imageToByteList) {
                     try {
                         ByteArrayInputStream in = new ByteArrayInputStream(bytes);
                         BufferedImage read = ImageIO.read(in);
                         String ocr = tess4jClient.doOCR(read);
                         log.info("OCRå›¾ç‰‡è¯†åˆ«ç»“æœï¼š{}", ocr);
                         if (ocr != null) {
                             content.append(ocr);
                         }
                     } catch (IOException e) {
                         e.printStackTrace();
                     } catch (TesseractException e) {
                         e.printStackTrace();
                     }
                 }
         ```

3. ä½¿ç”¨é˜¿é‡Œäº‘æ¥å£å®ç°ï¼ˆæ”¶è´¹ï¼‰

   1. ä½¿ç”¨æ–¹æ³•ï¼šæŸ¥çœ‹leadnews-basicä¸‹çš„audit-starteræ¨¡å—æˆ–è€…æŸ¥çœ‹é˜¿é‡Œäº‘å†…å®¹å®‰å…¨å®˜æ–¹æ–‡æ¡£  [é˜¿é‡Œäº‘å†…å®¹å®¡æ ¸æ–‡æ¡£](https://help.aliyun.com/document_detail/92546.html)

### éœ€æ±‚ï¼šå½“åˆ†è¡¨æ—¶ï¼Œæ–‡ç« idé‡å¤è§£å†³æ–¹æ³•

**åˆ†å¸ƒå¼id - ä½¿ç”¨é›ªèŠ±ç®—æ³•**

snowflakeæ˜¯Twitterå¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œç»“æœæ˜¯ä¸€ä¸ªlongå‹çš„IDã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šä½¿ç”¨41bitä½œä¸ºæ¯«ç§’æ•°ï¼Œ10bitä½œä¸ºæœºå™¨çš„IDï¼ˆ5ä¸ªbitæ˜¯æ•°æ®ä¸­å¿ƒï¼Œ5ä¸ªbitçš„æœºå™¨IDï¼‰ï¼Œ12bitä½œä¸ºæ¯«ç§’å†…çš„æµæ°´å·ï¼ˆæ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹åœ¨æ¯æ¯«ç§’å¯ä»¥äº§ç”Ÿ 4096 ä¸ª IDï¼‰ï¼Œæœ€åè¿˜æœ‰ä¸€ä¸ªç¬¦å·ä½ï¼Œæ°¸è¿œæ˜¯0

![image-20230103104201600](https://gitlab.com/JWPeng/image/-/raw/main/pictures/2023/01/5_9_32_46_4_12_38_24_3_10_42_8_image-20230103104201600.png)

**ä¸ºä»€ä¹ˆä½¿ç”¨é›ªèŠ±ç®—æ³•**

åœ¨æ•°æ®åº“åˆ†è¡¨åï¼Œæ•°æ®åº“è‡ªå¢çš„idå¯èƒ½ä¼šé‡å¤ï¼Œé›ªèŠ±ç®—æ³•ç”Ÿæˆ19ä½æ•°å­—ä¸é‡å¤ï¼Œæ¯æ¯«ç§’å¯ä»¥ç”Ÿæˆ4096ä¸ªä¸é‡å¤çš„æ•°ï¼ˆMyBatisPlusé»˜è®¤å°±æ˜¯é›ªèŠ±ç®—æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨@TableIdï¼ˆtype = IdType.ASSIGN_IDï¼‰ï¼‰

**ä¸ºä»€ä¹ˆåˆ†è¡¨**

å½“æ•°æ®åº“æ•°æ®è¾¾åˆ°500ä¸‡æ¡æ—¶ï¼Œæ•°æ®åº“çš„æ•ˆç‡å°±ä¼šå˜æ…¢

## 5)æ–‡ç« åŒæ­¥åˆ°appç«¯

ä½¿ç”¨FreeMarkerç”Ÿæˆé™æ€é¡µé¢å¹¶ä¸Šä¼ åˆ°MinIOä¸­

### éœ€æ±‚ï¼šå½“æ–‡ç« å®¡æ ¸é€šè¿‡åï¼Œç”Ÿæˆæ–‡ç« è¯¦æƒ…çš„é™æ€HTML

1. **ä½¿ç”¨æ–¹æ³•ï¼š**æŸ¥çœ‹æŸ¥çœ‹Appç«¯æ–‡ç« æŸ¥çœ‹çš„**é¡µé¢é™æ€åŒ–é›†æˆMinIO**

## 6)æ¨¡å—ä¼˜åŒ–

å½“ä¸€ä¸ªè¯·æ±‚ä¸­è°ƒç”¨çš„å…¶ä»–æœåŠ¡ï¼Œå¦‚æœå…¶ä»–æœåŠ¡ä¸è¿”å›ç»“æœå½“å‰æœåŠ¡éœ€è¦ç­‰å¾…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å¼‚æ­¥è°ƒç”¨å¯ä»¥æé«˜æ•ˆç‡ï¼Œç”¨æˆ·å¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œ 

### éœ€æ±‚ï¼šå¼‚æ­¥è°ƒç”¨

1. åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± å¹¶äº¤ä¸ªSpringç®¡ç†

   ```java
   @Configuration
   @EnableAsync//å¼€å¯å¼‚æ­¥è°ƒç”¨
   public class ThreadPoolConfig {
   
       private static final int corePoolSize = 10;   // æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆé»˜è®¤çº¿ç¨‹æ•°ï¼‰
       private static final int maxPoolSize = 100;   // æœ€å¤§çº¿ç¨‹æ•°
       private static final int keepAliveTime = 10;  // å…è®¸çº¿ç¨‹ç©ºé—²æ—¶é—´ï¼ˆå•ä½ï¼šé»˜è®¤ä¸ºç§’ï¼‰
       private static final int queueCapacity = 500; // ç¼“å†²é˜Ÿåˆ—æ•°
   
       /**
        * é»˜è®¤å¼‚æ­¥çº¿ç¨‹æ± 
        * @return
        */
       @Bean("taskExecutor")
       public ThreadPoolTaskExecutor taskExecutor(){
           ThreadPoolTaskExecutor pool = new ThreadPoolTaskExecutor();
           pool.setThreadNamePrefix(".............å…¨å±€çº¿ç¨‹æ± ..............");
           pool.setCorePoolSize(corePoolSize);
           pool.setMaxPoolSize(maxPoolSize);
           pool.setKeepAliveSeconds(keepAliveTime);
           pool.setQueueCapacity(queueCapacity);
           // ç›´æ¥åœ¨executeæ–¹æ³•çš„è°ƒç”¨çº¿ç¨‹ä¸­è¿è¡Œ
           pool.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
           pool.initialize();//åˆå§‹åŒ–çº¿ç¨‹æ± 
           return pool;
       }
   }
   ```

2. åœ¨æœåŠ¡è°ƒç”¨æ–¹æ³•çš„æ–¹æ³•ä¸Šæ·»åŠ 

   ```java
   // è¡¨ç¤ºå¼‚æ­¥è°ƒç”¨
   @Async("taskExecutor")//çº¿ç¨‹æ± çš„åç§°
   ```

   